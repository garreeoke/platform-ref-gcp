apiVersion: apiextensions.crossplane.io/v1
kind: Composition
metadata:
  name: xclusters.platformref.upbound.io
spec:
  compositeTypeRef:
    apiVersion: platformref.upbound.io/v1alpha1
    kind: XCluster
  resources:
    - base:
        apiVersion: platformref.upbound.io/v1alpha1
        kind: XNetwork
        compositionSelector:
          matchLabels:
            cloud: gcp
      patches:
        - fromFieldPath: spec.region
          toFieldPath: spec.region
        - fromFieldPath: spec.zone
          toFieldPath: spec.zone
        - fromFieldPath: spec.id
          toFieldPath: spec.id
        - fromFieldPath: spec.cloud
          toFieldPath: compositionSelector.matchLabels.cloud
      name: compositeNetwork
    - base:
        apiVersion: platformref.upbound.io/v1alpha1
        kind: XK8s
        compositionSelector:
          matchLabels:
            cloud: gcp # patched
      name: compositeK8s
      patches:
        - fromFieldPath: spec.version
          toFieldPath: spec.version
        - fromFieldPath: spec.region
          toFieldPath: spec.region
        - fromFieldPath: spec.zone
          toFieldPath: spec.zone
        - fromFieldPath: spec.id
          toFieldPath: spec.id
        - fromFieldPath: spec.cloud
          toFieldPath: compositionSelector.matchLabels.cloud
        - fromFieldPath: spec.id
          toFieldPath: metadata.annotations[crossplane.io/external-name]
        - fromFieldPath: spec.claimRef.namespace
          toFieldPath: spec.claim.namespace
        - fromFieldPath: spec.parameters.nodes.count
          toFieldPath: spec.parameters.nodes.count
        - fromFieldPath: spec.parameters.nodes.size
          toFieldPath: spec.parameters.nodes.size
    #- base:
    #    apiVersion: platformref.crossplane.io/v1alpha1
    #    kind: Chart
    #    compositionSelector:
    #      matchLabels:
    #        chart: prometheus
    #  name: clusterPrometheus
    #  patches:
    #    - fromFieldPath: spec.id
    #      toFieldPath: spec.providerConfigRef.name
